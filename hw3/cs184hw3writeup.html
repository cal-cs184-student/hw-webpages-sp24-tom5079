<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=XGMkxXUZTA64h2imyzu79g);ol{margin:0;padding:0}table td,table th{padding:0}.c1{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#ffffff;border-top-width:1pt;border-right-width:1pt;border-left-color:#ffffff;vertical-align:top;border-right-color:#ffffff;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:234pt;border-top-color:#ffffff;border-bottom-style:solid}.c2{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:156pt;border-top-color:#000000;border-bottom-style:solid}.c14{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left;height:16pt}.c4{padding-top:0pt;padding-bottom:3pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c18{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c10{padding-top:20pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c15{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c11{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:20pt;font-family:"Arial";font-style:normal}.c16{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:26pt;font-family:"Arial";font-style:normal}.c5{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c17{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c6{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.c8{border-spacing:0;border-collapse:collapse;margin-right:auto}.c9{font-family:"Roboto Mono";color:#188038;font-weight:400}.c13{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c3{height:0pt}.c7{height:11pt}.c12{color:#188038}.c19{font-weight:700}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c13 doc-content"><p class="c4 title" id="h.mzgv8mh42cb8"><span class="c16">HW 3: Pathtracer</span></p><h1 class="c10" id="h.jl3c57aizjji"><span class="c11">Overview</span></h1><p class="c5"><span class="c0">In HW 3, we explored various ray tracing algorithms and accelerations/optimizations to render more photorealistic scene lighting. We implemented ray generation and triangle intersection, the bounding volume hierarchy acceleration, direct and indirect lighting functions, and adaptive sampling to efficiently focus computing power on areas with lower convergence rates. Applying these methods to the rendering pipeline produces much richer images for scenes with complex lighting environments.</span></p><h1 class="c10" id="h.gaqxn599r8iw"><span class="c11">Part 1: Ray Generation and Scene Intersection</span></h1><p class="c5"><span class="c0">Ray is generated by calculating the point where the ray that originated from the camera origin lands in world coordinates.</span></p><p class="c5"><span class="c0">The landing point is</span></p><p class="c5"><img src="images/image1.png"><span class="c0">.</span></p><p class="c5"><span>We then multiply this with </span><span class="c9">c2w</span><span class="c0">&nbsp;matrix to convert it from camera coordinate to world coordinate and normalize it to get the direction vector.</span></p><p class="c5"><span class="c0">The origin of the ray is the same as the origin of the camera.</span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span class="c0">Then we use this ray to calculate if the ray is intersecting with the triangle meshes in the scene.</span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span class="c0">The equation used for the triangle intersection is</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 300.00px; height: 19.00px;"><img alt="" src="images/image23.png" style="width: 300.00px; height: 19.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">We can rewrite this as</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 315.00px; height: 19.00px;"><img alt="" src="images/image34.png" style="width: 315.00px; height: 19.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">Which is equivalent to</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 295.00px; height: 66.00px;"><img alt="" src="images/image43.png" style="width: 295.00px; height: 66.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c0">.</span></p><p class="c5"><span class="c0">We can now solve for t, u, v with</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 555.00px; height: 210.00px;"><img alt="" src="images/image16.png" style="width: 555.00px; height: 210.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c0">.</span></p><p class="c5"><span class="c0">Furthermore, </span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 441.00px; height: 19.00px;"><img alt="" src="images/image8.png" style="width: 441.00px; height: 19.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span>So </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 85.00px; height: 19.00px;"><img alt="" src="images/image50.png" style="width: 85.00px; height: 19.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>, </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 10.00px; height: 8.00px;"><img alt="" src="images/image51.png" style="width: 10.00px; height: 8.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>, </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 9.00px; height: 8.00px;"><img alt="" src="images/image39.png" style="width: 9.00px; height: 8.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span class="c0">&nbsp;are the barycentric coordinate of the triangle.</span></p><p class="c5"><span>We just have to check if </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 196.00px; height: 19.00px;"><img alt="" src="images/image37.png" style="width: 196.00px; height: 19.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;and </span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 163.00px; height: 15.00px;"><img alt="" src="images/image45.png" style="width: 163.00px; height: 15.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span>&nbsp;to see if the ray intersect with the triangle.</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image49.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 480.00px; height: 360.00px;"><img alt="" src="images/image15.png" style="width: 480.00px; height: 360.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c14" id="h.rrsl5u3gyvd"><span class="c18"></span></h2><h1 class="c10" id="h.z0h4uew8r8wl"><span class="c11">Part 2: Bounding Volume Hierarchy</span></h1><p class="c5"><span>Our BVH construction algorithm first takes the average of the centroids of each primitive in the list. It checks if the current size is under the max_leaf_size threshold; if not, it will select the longest axis as a heuristic choice, sort along this axis, then partition the primitives into two groups with the average of the centroids as the split point. These groups are passed back into </span><span class="c9">construct_bvh </span><span class="c0">recursively and assigned to the BVH node&rsquo;s left and right children.</span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span class="c0">BVH acceleration makes it possible to render larger dae files such as CBlucy.dae, with 133796 primitives and 464698 rays, and blob.dae, with 196608 primitives and 452068 rays, in just fractions of a second.</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 302.19px; height: 226.64px;"><img alt="" src="images/image19.png" style="width: 302.19px; height: 226.64px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 303.04px; height: 227.28px;"><img alt="" src="images/image40.png" style="width: 303.04px; height: 227.28px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span class="c0">The following table compares the execution time of rendering a few scenes with moderately complex geometries with and without BVH acceleration, controlled at 8 threads and 800x600 resolution. It is evident that BVH acceleration dramatically increases performance as it structurally clusters primitives and computes rays as they intersect with bounding volumes rather than every object in the scene. The tradeoff is an increased, yet usually negligible, BVH construction time except in extreme cases where the algorithm may produce a degenerate tree. This can be addressed with more robust code or applying more advanced heuristics.</span></p><p class="c5 c7"><span class="c0"></span></p><a id="t.14c3fe71c687577988ec55a016bc04e37b529b2d"></a><a id="t.0"></a><table class="c8"><tr class="c3"><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">DAE</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">Without BVH acceleration</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">With BVH acceleration</span></p></td></tr><tr class="c3"><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">maxplanck.dae</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 160.19px; height: 119.37px;"><img alt="" src="images/image48.png" style="width: 160.19px; height: 119.37px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">Collecting primitives: 0.0139 s</span></p><p class="c6"><span class="c0">Building BVH: 0.0021 s</span></p><p class="c6"><span class="c0">Rendering: 139.8163 s</span></p><p class="c6"><span class="c0">Total: 139.8323 s</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">Collecting primitives: 0.0114 s</span></p><p class="c6"><span class="c0">Building BVH: 0.0512 s</span></p><p class="c6"><span class="c0">Rendering: 0.1072 s</span></p><p class="c6"><span class="c0">Total: 0.01698 s</span></p></td></tr><tr class="c3"><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">cow.dae</span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 161.50px; height: 121.13px;"><img alt="" src="images/image33.png" style="width: 161.50px; height: 121.13px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">Collecting primitives: 0.0011 s</span></p><p class="c6"><span class="c0">Building BVH: 0.0001 s</span></p><p class="c6"><span class="c0">Rendering: 13.9136 s</span></p><p class="c6"><span class="c0">Total: 13.9148 s</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">Collecting primitives: 0.0016 s</span></p><p class="c6"><span class="c0">Building BVH: 0.0052 s</span></p><p class="c6"><span class="c0">Rendering: 0.09 s</span></p><p class="c6"><span class="c0">Total: 0.0968 s</span></p></td></tr><tr class="c3"><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">peter.dae</span></p><p class="c6"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 161.50px; height: 120.71px;"><img alt="" src="images/image7.png" style="width: 161.50px; height: 120.71px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">Collecting primitives: 0.0095 s</span></p><p class="c6"><span class="c0">Building BVH: 0.0013 s</span></p><p class="c6"><span class="c0">Rendering: 121.5070 s</span></p><p class="c6"><span class="c0">Total: 121.5178 s</span></p></td><td class="c2" colspan="1" rowspan="1"><p class="c6"><span class="c0">Collecting primitives: 0.0108 s</span></p><p class="c6"><span class="c0">Building BVH: 0.1352 s</span></p><p class="c6"><span class="c0">Rendering: 0.1103 s</span></p><p class="c6"><span class="c0">Total: 0.2563 s</span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p><h1 class="c10" id="h.7wrllslxzcvu"><span class="c11">Part 3: Direct Illumination</span></h1><p class="c5"><span>Uniform Hemisphere Sampling works by choosing a random direction sampled from a hemisphere aligned with the normal vector of the intersection point. New ray is casted with the origin of the intersection point and the direction of a randomly chosen vector on the hemisphere transformed with the </span><span class="c9">o2w </span><span class="c0">matrix.</span></p><p class="c5"><span>Importance sampling on the other hand is performed by iterating through all the light sources in the scene and sampling a random vector towards the light source. After we sample the vector, we check if any other object is obscuring the line of sight. This is done by a ray with the origin of the intersection point and the direction of the sampled vector towards the light source with </span><span class="c9">t_min</span><span>&nbsp;of </span><span class="c9">EPS_F</span><span>&nbsp;and </span><span class="c9">t_max</span><span>&nbsp;of </span><span class="c9">distToLight - EPS_F</span><span>.If</span><span>&nbsp;there is a hit</span><span class="c0">, we ignore the light source as the ray is obscured by another object.</span></p><p class="c5 c7"><span class="c0"></span></p><a id="t.7b9ff160cc081348119d81b578c52633590dce03"></a><a id="t.1"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 244.50px; height: 183.38px;"><img alt="" src="images/image20.png" style="width: 244.50px; height: 183.38px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">Uniform Hemisphere Sampling</span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 245.15px; height: 183.86px;"><img alt="" src="images/image10.png" style="width: 245.15px; height: 183.86px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">Importance Sampling</span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p><a id="t.e07011a07518a91b5963c3f0bbbeb32d306ea76a"></a><a id="t.2"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 240.10px; height: 180.07px;"><img alt="" src="images/image25.png" style="width: 240.10px; height: 180.07px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">l=1</span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 239.25px; height: 179.43px;"><img alt="" src="images/image44.png" style="width: 239.25px; height: 179.43px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">l=4</span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 240.05px; height: 180.04px;"><img alt="" src="images/image14.png" style="width: 240.05px; height: 180.04px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c6"><span class="c0">l=16</span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 238.48px; height: 178.86px;"><img alt="" src="images/image14.png" style="width: 238.48px; height: 178.86px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c6"><span class="c0">l=64</span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span>As importance sampling focuses the sampling towards light sources, it is less noisy compared to uniform sampling as it generates more valid samples. While uniform sampling may initially seem to simulate lighting more accurately as it distributes and samples evenly around the hemisphere, the results above prove the power of importance sampling. Importance sampling may also perform better since it concentrates samples where light is expected to have more effect, while minimizing samples at flat angles.</span></p><h1 class="c10" id="h.5tudix8ybbqc"><span class="c11">Part 4: Global Illumination</span></h1><p class="c5"><span>Using the </span><span class="c9">sample_f</span><span>&nbsp;function of the intersection point&rsquo;s </span><span class="c9">bsdf</span><span>, we sample which way to bounce next. Then using a ray with an origin of the intersection point and the direction of </span><span class="c9">o2w * w_in</span><span>&nbsp;where </span><span class="c9">w_in</span><span>&nbsp;is the direction vector sample by </span><span class="c9">sample_f</span><span>, we check if there is an object that intersects with the array. If there is an intersect, we recursively call the </span><span class="c9">at_least_one_bounce_radiance</span><span>&nbsp;with the ray used for the intersection check with depth </span><span class="c9">r.depth-1</span><span>&nbsp;and add the result to the return value using the reflection equation. We optionally add the </span><span class="c9">one_bounce_radiance</span><span>&nbsp;of the intersection point according to </span><span class="c9">isAccumBounces</span><span class="c0">.</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 202.41px; height: 152.50px;"><img alt="" src="images/image52.png" style="width: 202.41px; height: 152.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 200.50px; height: 150.83px;"><img alt="" src="images/image26.png" style="width: 200.50px; height: 150.83px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 199.82px; height: 149.86px;"><img alt="" src="images/image4.png" style="width: 199.82px; height: 149.86px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">Sample rendering with s=1024</span></p><p class="c5 c7"><span class="c0"></span></p><a id="t.0141dd490dee8714b6c17594b8d9265be20d2a8a"></a><a id="t.3"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image11.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">Direct lighting only</span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image18.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c5"><span class="c0">Indirect lighting only</span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c17"><span class="c9">IsAccumBounces=false</span></p><a id="t.3bf4aeca67019b85c312f6391f8ea01073710bd2"></a><a id="t.4"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span class="c0">m=0</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 272.54px; height: 204.86px;"><img alt="" src="images/image6.png" style="width: 272.54px; height: 204.86px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=1</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 271.19px; height: 203.39px;"><img alt="" src="images/image54.png" style="width: 271.19px; height: 203.39px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=2</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 274.53px; height: 206.36px;"><img alt="" src="images/image53.png" style="width: 274.53px; height: 206.36px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=3</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 271.50px; height: 201.11px;"><img alt="" src="images/image13.png" style="width: 271.50px; height: 201.11px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=4</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 275.50px; height: 207.09px;"><img alt="" src="images/image55.png" style="width: 275.50px; height: 207.09px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=5</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 273.80px; height: 205.85px;"><img alt="" src="images/image46.png" style="width: 273.80px; height: 205.85px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></table><p class="c5"><span class="c0">For the 2nd and 3rd bounces, we can see the reflected light from the surface hitting another object and illuminating them. We can also observe the color of the wall reflected on the bunny. This greatly improves the photorealism of the rendered image as the light behaves in a photorealistic way.</span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c9">isAccumBounces=true</span></p><a id="t.3bf4aeca67019b85c312f6391f8ea01073710bd2"></a><a id="t.5"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span class="c0">m=0</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image6.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span class="c0">m=1</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image17.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span class="c0">m=2</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image28.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span class="c0">m=3</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 222.67px;"><img alt="" src="images/image9.png" style="width: 298.00px; height: 222.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span class="c0">m=4</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 293.74px; height: 220.79px;"><img alt="" src="images/image9.png" style="width: 293.74px; height: 220.79px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span class="c0">m=5</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 222.67px;"><img alt="" src="images/image9.png" style="width: 298.00px; height: 222.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p><hr style="page-break-before:always;display:none;"><p class="c5 c7"><span class="c0"></span></p><p class="c17"><span class="c15">Russian Roulette</span></p><a id="t.3bf4aeca67019b85c312f6391f8ea01073710bd2"></a><a id="t.6"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=0</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image30.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=1</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image38.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=2</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image22.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=3</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image27.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=4</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image47.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">m=5</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image29.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><p class="c17"><span class="c19">Varying Sample-per-pixel Rates</span></p><a id="t.12e3f618f7bad7cfa1c15ee6b7cca7621e4c7c9b"></a><a id="t.7"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">s=1</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image31.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">s=2</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image31.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">s=4</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image42.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">s=8</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image12.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">s=16</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image5.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">s=64</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image41.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6 c7"><span class="c0"></span></p><p class="c6 c7"><span class="c0"></span></p><p class="c6"><span class="c0">s=1024</span></p><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 224.00px;"><img alt="" src="images/image35.png" style="width: 298.00px; height: 224.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6 c7"><span class="c0"></span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span class="c0">As we increase the camera rays per pixel between renders, the images get progressively less noisy. This makes sense intuitively as each pixel would have a more complete computation of its illuminance as more rays and intersections are processed in random directions. At s=1024, the render looks virtually noise-free.</span></p><h1 class="c10" id="h.938m7ba3ji0t"><span class="c11">Part 5: Adaptive Sampling</span></h1><p class="c5"><span class="c0">Some pixels require more samples to converge than others. Adaptive sampling takes advantage of this by concentrating samples in &ldquo;denser&rdquo; parts of the scene, such as areas with more shadows and shading across complex geometries, rather than applying some constant high sampling rate for every pixel. This involves statistically testing for a pixel&rsquo;s &ldquo;convergence&rdquo; at regular intervals of sampling.</span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5"><span>Adaptive sampling is implemented in </span><span class="c9">PathTracer::raytrace_pixel</span><span>&nbsp;in pathtracer.cpp, modifying part 1 to statistically test for pixel convergence. We use </span><span class="c9">num_samples</span><span class="c12">&nbsp;</span><span>to count the current iterations and initialize it to 0. We define 2 new float variables </span><span class="c9">sum_illum</span><span>&nbsp;and </span><span class="c9">sqsum_illum</span><span>, representing the sum and square sum of the illuminance values of each sample respectively. In the loop that iterates over </span><span class="c9">ns_aa</span><span>&nbsp;samples, we retrieve the illuminance of a sample with </span><span class="c9">float illum = sample.illum()</span><span>, where </span><span class="c12">sample</span><span>&nbsp;is the pixel&rsquo;s radiance as a 3D vector, and add it to </span><span class="c12">sum_illum</span><span>&nbsp;and </span><span class="c9">illum * illum</span><span>&nbsp;to </span><span class="c9">sqsum_illum</span><span>. For every </span><span class="c9">samplesPerBatch</span><span>&nbsp;(default 32) iterations, we test for pixel convergence using the equation given in the specification </span><img src="images/image2.png"><span>, where </span><img src="images/image3.png"><span>&nbsp;</span><span class="c9">(sqsum_illum - sum_illum * sum_illum / num_samples) / (num_samples - 1)</span><span>, </span><span>&nbsp;</span><span class="c9">maxTolerance</span><span class="c0">=0.5 by default and &mu; is the running average illuminance of the samples. If this condition has been met, we can assume that the pixel has converged with 95% confidence and then break from the loop.</span></p><p class="c5 c7"><span class="c0"></span></p><p class="c5 c7"><span class="c0"></span></p><a id="t.004fa0be0f2afd6732c4c01f8753f072167a62ca"></a><a id="t.8"></a><table class="c8"><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">Render (adaptive sampling)</span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c6"><span class="c0">Rate</span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 221.33px;"><img alt="" src="images/image32.png" style="width: 298.00px; height: 221.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 222.67px;"><img alt="" src="images/image24.png" style="width: 298.00px; height: 222.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr><tr class="c3"><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 222.67px;"><img alt="" src="images/image21.png" style="width: 298.00px; height: 222.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td><td class="c1" colspan="1" rowspan="1"><p class="c5"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 298.00px; height: 222.67px;"><img alt="" src="images/image36.png" style="width: 298.00px; height: 222.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p></td></tr></table><p class="c5 c7"><span class="c0"></span></p></body></html>